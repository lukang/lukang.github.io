__require=function t(e,o,n){function a(s,c){if(!o[s]){if(!e[s]){var r="function"==typeof __require&&__require;if(!c&&r)return r(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=o[s]={exports:{}};e[s][0].call(l.exports,function(t){var o=e[s][1][t];return a(o||t)},l,l.exports,t,e,o,n)}return o[s].exports}for(var i="function"==typeof __require&&__require,s=0;s<n.length;s++)a(n[s]);return a}({Bullet:[function(t,e,o){"use strict";cc._RF.push(e,"20d7dzfVhZNh4gNZzwaQgEl","Bullet"),cc.Class({extends:cc.Component,properties:{speed:100},onLoad:function(){},onCollisionEnter:function(t,e){this.node.destroy()},update:function(t){this.node.y+=this.speed*t}}),cc._RF.pop()},{}],Constants:[function(t,e,o){"use strict";cc._RF.push(e,"470aaArjndBxI5ZXC1Mxcr6","Constants"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.EVENT_HOUSE_LVL_UP="house_level_up",t.EVENT_HOUSE_BUILD_GOLD="house_build_gold",t}();o.Constants=n,cc._RF.pop()},{}],DataCenter:[function(t,e,o){"use strict";cc._RF.push(e,"5e77fqjtDFC+aZfZFUVf9+c","DataCenter"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Player"),a=function(){function t(){}return t.init=function(){},t.init_player=function(){var t=cc.sys.localStorage.getItem("player");return Object.assign(new n.Player,JSON.parse(t))},t.prototype.init_house=function(){},t.save_player=function(t){cc.sys.localStorage.setItem("player",JSON.stringify(t))},t.save_house=function(){},t}();o.DataCenter=a,cc._RF.pop()},{"./Player":"Player"}],Game:[function(t,e,o){"use strict";cc._RF.push(e,"f9a8dHjdcpBQLmga8eSitji","Game"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./MonsterManager"),a=cc._decorator,i=a.ccclass,s=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.main_bg_a=null,e.main_bg_b=null,e.main_bg_c=null,e.main_bg_d=null,e.main_bg_e=null,e.area_id=0,e}return __extends(e,t),e.prototype.start=function(){console.log("start"),this.init_monsters()},e.prototype.init=function(t){this.area_id=t;var e=this;cc.loader.loadRes("image/main_bg/main_bg_a_0"+this.area_id,cc.SpriteFrame,function(t,o){e.main_bg_a.spriteFrame=o}),cc.loader.loadRes("image/bg"+this.area_id+"/main_bg_b_0"+this.area_id,cc.SpriteFrame,function(t,o){e.main_bg_b.spriteFrame=o}),cc.loader.loadRes("image/bg"+this.area_id+"/main_bg_c_0"+this.area_id,cc.SpriteFrame,function(t,o){e.main_bg_c.spriteFrame=o}),cc.loader.loadRes("image/bg"+this.area_id+"/main_bg_d_0"+this.area_id,cc.SpriteFrame,function(t,o){e.main_bg_d.spriteFrame=o}),cc.loader.loadRes("image/bg"+this.area_id+"/main_bg_e_0"+this.area_id,cc.SpriteFrame,function(t,o){e.main_bg_e.spriteFrame=o})},e.prototype.init_monsters=function(){for(var t=1;t<10;t++)n.MonsterManager.loadMonster(this.node,t,1)},__decorate([s(cc.Sprite)],e.prototype,"main_bg_a",void 0),__decorate([s(cc.Sprite)],e.prototype,"main_bg_b",void 0),__decorate([s(cc.Sprite)],e.prototype,"main_bg_c",void 0),__decorate([s(cc.Sprite)],e.prototype,"main_bg_d",void 0),__decorate([s(cc.Sprite)],e.prototype,"main_bg_e",void 0),e=__decorate([i],e)}(cc.Component);o.Game=c,cc._RF.pop()},{"./MonsterManager":"MonsterManager"}],House:[function(t,e,o){"use strict";cc._RF.push(e,"406d2IgDHVHTbUBk0SAS/eg","House"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./MainScene"),a=t("./Constants"),i=cc._decorator,s=i.ccclass,c=i.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.jsonData={id:0,name:"",desc:"",base_cd:10,base_lvup_gold:10,base_output_gold:10,base_lvup_gold2:10,base_output_gold2:10,level:0,lvup_gold:0,output_gold:0,star:1,cdTime:0,passTime:0},e.mainScene=null,e.nameLabel=null,e.desc=null,e.lv=null,e.time=null,e.lvlUp=null,e.icon=null,e.progress=null,e.lvup_gold_label=null,e.lvlup_btn_name=null,e}return __extends(e,t),e.prototype.init_info=function(t){this.node.active=!0,this.jsonData=t,this.jsonData.id=parseInt(t.id),this.jsonData.base_cd=parseFloat(t.base_cd),this.jsonData.base_lvup_gold=parseFloat(t.base_lvup_gold),this.jsonData.base_lvup_gold2=parseFloat(t.base_lvup_gold2),this.jsonData.base_output_gold=parseFloat(t.base_output_gold),this.jsonData.base_output_gold2=parseFloat(t.base_output_gold2),t.level||(this.jsonData.level=0,this.jsonData.passTime=0,this.progress.progress=0,this.lvlup_btn_name.string="\u89e3\u9501",this.node.color=cc.color(100,100,100)),this.jsonData.star=this.get_star(),this.jsonData.cdTime=this.get_cd(),this.jsonData.lvup_gold=this.get_lvup_gold(this.jsonData.level+1),this.jsonData.output_gold=this.get_output_gold(this.jsonData.level),cc.log(JSON.stringify(this.jsonData)),this.update_ui(),this.schedule(this.runtime,1)},e.prototype.update_ui=function(){this.nameLabel.string=this.jsonData.name,this.desc.string=this.jsonData.desc||"",this.lv.string="Lv."+this.jsonData.level.toString(),this.lvup_gold_label.string=this.jsonData.lvup_gold.toString()},e.prototype.runtime=function(){if(!(this.jsonData.cdTime<=0||this.jsonData.level<=0)){this.jsonData.passTime+=1;var t=this.jsonData.cdTime-this.jsonData.passTime;t<=0&&(this.jsonData.passTime=0,this.mainScene.addGold(this.jsonData.output_gold)),this.time.string="00:"+t.toString(),this.save()}},e.prototype.update=function(t){if(!(this.jsonData.cdTime<=0||this.jsonData.level<=0)){var e=this.progress.progress;(e+=t/this.jsonData.cdTime)>1&&(e=0),this.progress.progress=e}},e.prototype.get_star=function(){var t=this.jsonData.level;return t>1e3?17:t>850?16:t>850?15:t>700?14:t>600?13:t>500?12:t>400?11:t>325?10:t>275?9:t>250?8:t>200?7:t>150?6:t>100?5:t>75?4:t>50?3:t>25?2:1},e.prototype.get_cd=function(){return Math.ceil(this.jsonData.base_cd/Math.pow(2,this.jsonData.star-1))},e.prototype.get_lvup_gold=function(t){return this.jsonData.base_lvup_gold*t+t*(t-1)/2*this.jsonData.base_lvup_gold2*Math.pow(Math.ceil(t/10),2)*Math.pow(Math.ceil(t/100),3)*Math.pow(Math.ceil(t/500),4)},e.prototype.get_output_gold=function(t){return this.jsonData.base_output_gold*t+t*(t-1)/2*this.jsonData.base_output_gold2*Math.ceil(t/50)*Math.pow(Math.ceil(t/100),2)*Math.pow(Math.ceil(t/500),3)},e.prototype.build=function(){},e.prototype.lvlUpOnClick=function(){console.log("[House] lvlUpOnClick = "+this.jsonData.id),this.mainScene.getGold()>this.jsonData.lvup_gold&&(this.mainScene.addGold(-this.jsonData.lvup_gold),this.jsonData.level+=1,this.jsonData.star=this.get_star(),this.jsonData.cdTime=this.get_cd(),this.jsonData.lvup_gold=this.get_lvup_gold(this.jsonData.level+1),this.jsonData.output_gold=this.get_output_gold(this.jsonData.level),this.lvlup_btn_name.string="\u5347\u7ea7",this.update_ui(),this.save(),this.mainScene.node.emit(a.Constants.EVENT_HOUSE_LVL_UP,this))},e.prototype.build_gold=function(t){return 0},e.prototype.save=function(){cc.sys.localStorage.setItem("house_"+this.jsonData.id,JSON.stringify(this.jsonData))},__decorate([c(n.MainScene)],e.prototype,"mainScene",void 0),__decorate([c(cc.Label)],e.prototype,"nameLabel",void 0),__decorate([c(cc.Label)],e.prototype,"desc",void 0),__decorate([c(cc.Label)],e.prototype,"lv",void 0),__decorate([c(cc.Label)],e.prototype,"time",void 0),__decorate([c(cc.Button)],e.prototype,"lvlUp",void 0),__decorate([c(cc.Sprite)],e.prototype,"icon",void 0),__decorate([c(cc.ProgressBar)],e.prototype,"progress",void 0),__decorate([c(cc.Label)],e.prototype,"lvup_gold_label",void 0),__decorate([c(cc.Label)],e.prototype,"lvlup_btn_name",void 0),e=__decorate([s],e)}(cc.Component);o.House=r,cc._RF.pop()},{"./Constants":"Constants","./MainScene":"MainScene"}],Item:[function(t,e,o){"use strict";cc._RF.push(e,"3ac170cTLpH+KWIgjzJ48g6","Item"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./MainScene"),a=t("./Constants"),i=cc._decorator,s=i.ccclass,c=i.property,r=function(t){function e(){var e=t.call(this)||this;return e.jsonData={id:0,name:"",desc:"",gold:100,level:1,cdTime:10,passTime:0},e.mainScene=null,e.nameLabel=null,e.desc=null,e.lv=null,e.time=null,e.lvlUp=null,e.icon=null,e.progress=null,e}return __extends(e,t),e.prototype.init=function(t){cc.sys.localStorage.getItem("house_"+t)&&(this.jsonData=JSON.parse(cc.sys.localStorage.getItem("house_"+t)),console.log(this.jsonData)),this.nameLabel.string=this.jsonData.name,this.lv.string="Lv."+this.jsonData.level.toString(),this.desc.string=this.jsonData.desc.toString()},e.prototype.lvlUpOnClick=function(){console.log("[Item] lvlUpOnClick = "+this.jsonData.id),this.mainScene.getGold()>this.jsonData.gold*this.jsonData.level&&(this.mainScene.addGold(-this.jsonData.gold*this.jsonData.level),this.mainScene.node.emit(a.Constants.EVENT_HOUSE_LVL_UP,this),this.jsonData.level+=1,this.lv.string="Lv."+this.jsonData.level.toString(),this.save())},e.prototype.save=function(){cc.sys.localStorage.setItem("house_"+this.jsonData.id,JSON.stringify(this.jsonData))},__decorate([c(n.MainScene)],e.prototype,"mainScene",void 0),__decorate([c(cc.Label)],e.prototype,"nameLabel",void 0),__decorate([c(cc.Label)],e.prototype,"desc",void 0),__decorate([c(cc.Label)],e.prototype,"lv",void 0),__decorate([c(cc.Label)],e.prototype,"time",void 0),__decorate([c(cc.Button)],e.prototype,"lvlUp",void 0),__decorate([c(cc.Sprite)],e.prototype,"icon",void 0),__decorate([c(cc.ProgressBar)],e.prototype,"progress",void 0),e=__decorate([s],e)}(cc.Component);o.Item=r,cc._RF.pop()},{"./Constants":"Constants","./MainScene":"MainScene"}],MainScene:[function(t,e,o){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","MainScene"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./House"),a=t("./Constants"),i=cc._decorator,s=i.ccclass,c=i.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.playerData={gold:100,house_num:3},e.lgold=null,e.item1=null,e.content=null,e.house_items=[],e}var o;return __extends(e,t),o=e,e.prototype.start=function(){var t=this;console.log("start..."),o.clear(),this.init_config(function(){t.init_player(),t.init_houses(),t.init_ui(),t.init_event_listener(),console.log("started")})},e.prototype.addGold=function(t){this.playerData.gold=this.playerData.gold+t,this.lgold.string=this.playerData.gold.toString(),cc.sys.localStorage.setItem("player",JSON.stringify(this.playerData));for(var e=1;e<this.house_items.length;e++){var o=this.house_items[e];o&&(this.playerData.gold>=o.jsonData.lvup_gold?o.lvlUp.interactable=!0:o.lvlUp.interactable=!1)}},e.prototype.getGold=function(){return this.playerData.gold},e.clear=function(){cc.sys.localStorage.clear()},e.prototype.getHouseById=function(t){var e=this.house_items[t];if(!e){var o=this.item1;t>1&&(o=cc.instantiate(this.item1),this.content.addChild(o)),e=o.getComponent(n.House),this.house_items[t]=e}return e},e.prototype.init_ui=function(){this.lgold.string=this.playerData.gold.toString();for(var t=this.config.house,e=0;e<t.length;e++){var o="house_"+t[e].id,n=cc.sys.localStorage.getItem(o);if(!n)return;var a=this.getHouseById(t[e].id);a&&a.init_info(JSON.parse(n))}},e.prototype.init_config=function(t){var e=this;cc.loader.loadRes("config/config",function(o,n){o?cc.log(o):(e.config=n.json,t&&e.scheduleOnce(t))})},e.prototype.init_player=function(){var t=cc.sys.localStorage.getItem("player");t?this.playerData=JSON.parse(t):cc.sys.localStorage.setItem("player",JSON.stringify(this.playerData))},e.prototype.init_houses=function(){for(var t=this.config.house,e=0;e<t.length;e++){var o="house_"+t[e].id,n=cc.sys.localStorage.getItem(o);if(n||(n=JSON.stringify(t[e]),cc.sys.localStorage.setItem(o,n)),!JSON.parse(n).level)return}},e.prototype.init_event_listener=function(){var t=this;this.node.on(a.Constants.EVENT_HOUSE_LVL_UP,function(e){t.init_houses(),t.init_ui()})},__decorate([c(cc.Label)],e.prototype,"lgold",void 0),__decorate([c(cc.Node)],e.prototype,"item1",void 0),__decorate([c(cc.Node)],e.prototype,"content",void 0),e=o=__decorate([s],e)}(cc.Component);o.MainScene=r,cc._RF.pop()},{"./Constants":"Constants","./House":"House"}],MonsterManager:[function(t,e,o){"use strict";cc._RF.push(e,"d4efctT2axLbLFRusX8ZJQC","MonsterManager"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Monster"),a=cc._decorator,i=a.ccclass,s=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.loadMonster=function(t,e,o){cc.loader.loadRes("Prefabs/monster/monster_"+e,cc.Prefab,function(a,i){if(a)cc.log(a);else{cc.loader.setAutoRelease(i,!0);var s=cc.instantiate(i);s.getComponent(n.default).init_info(e,o);var c=new cc.Node;c.addChild(s),c.position=cc.v2(720*Math.random()-360,-(200+200*Math.random())),t.addChild(c)}})},e=__decorate([i],e)}(cc.Component));o.MonsterManager=s,cc._RF.pop()},{"./Monster":"Monster"}],Monster:[function(t,e,o){"use strict";cc._RF.push(e,"dfb739l4wFAE7B1RmEVhau6","Monster"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,i=n.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.jsonData={id:0,name:"",desc:"",gold:100,level:1},e.nameLabel=null,e.lv=null,e}return __extends(e,t),e.prototype.init_info=function(t,e){this.jsonData.id=t,this.jsonData.level=e},e.prototype.OnClick=function(){cc.log("[Monster] OnClick id = "+this.jsonData.id)},__decorate([i(cc.Label)],e.prototype,"nameLabel",void 0),__decorate([i(cc.Label)],e.prototype,"lv",void 0),e=__decorate([a],e)}(cc.Component);o.default=s,cc._RF.pop()},{}],NodeGenerator:[function(t,e,o){"use strict";cc._RF.push(e,"ef2f3CdJFdO8a4c63pAipi6","NodeGenerator"),cc.Class({extends:cc.Component,properties:{prefab:cc.Prefab,hint:cc.Label,regionOrigin:cc.Vec2,regionSize:cc.Size},onLoad:function(){this.schedule(this.generateNode,2),this._pool=new cc.NodePool("PoolHandler"),this._count=0},generateNode:function(){var t=this._pool.get();t||(t=cc.instantiate(this.prefab),this._count++,this.hint.string="Node Created: "+this._count,t.addComponent("PoolHandler")),t.x=this.regionOrigin.x+Math.floor(Math.random()*this.regionSize.width),t.y=this.regionOrigin.y+Math.floor(Math.random()*this.regionSize.height);var e=Math.random()*Math.PI*2,o=500*Math.cos(e),n=500*Math.sin(e);t.runAction(cc.sequence(cc.moveBy(5,o,n),cc.callFunc(this.removeNode,this,t))),this.node.addChild(t)},removeNode:function(t,e){this._pool.put(e)}}),cc._RF.pop()},{}],Player:[function(t,e,o){"use strict";cc._RF.push(e,"3a921Mp5vZJJqlPkS7HsEqj","Player"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,i=(n.property,function(){function t(){this.gold=0}return t.prototype.build_gold=function(t){return console.log("[Player] build_gold = 0"),0},t.prototype.dump=function(){console.log("[Player] dump = "+JSON.stringify(this))},t=__decorate([a],t)}());o.Player=i,cc._RF.pop()},{}],PoolHandler:[function(t,e,o){"use strict";cc._RF.push(e,"85024MWsM1OXqVRHBLcyASP","PoolHandler");var n=0;function a(){var t=Date.now();if(t-n<300){this.stopAllActions();var e=this.getComponent("PoolHandler")._pool;e?e.put(this):this.removeFromParent(!0)}else this.paused?cc.director.getActionManager().resumeTarget(this):cc.director.getActionManager().pauseTarget(this),this.paused=!this.paused;n=t}cc.Class({extends:cc.Component,properties:{_pool:null},onLoad:function(){this.reuse()},unuse:function(){this.node.off(cc.Node.EventType.TOUCH_END,a,this.node)},reuse:function(){this.node.paused=!1,this.node.on(cc.Node.EventType.TOUCH_END,a,this.node)}}),cc._RF.pop()},{}],Shooter:[function(t,e,o){"use strict";cc._RF.push(e,"092a3wYF7pBULdP9SLwGUBQ","Shooter"),cc.Class({extends:cc.Component,properties:{bullet:{default:null,type:cc.Node}},onLoad:function(){cc.director.getCollisionManager().enabled=!0,cc.director.getCollisionManager().enabledDebugDraw=!0,cc.find("Canvas").on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this)},onTouchBegan:function(t){var e=cc.director.getScene(),o=t.touch.getLocation(),n=cc.instantiate(this.bullet);n.position=o,n.active=!0,e.addChild(n)},onDisable:function(){cc.director.getCollisionManager().enabled=!1,cc.director.getCollisionManager().enabledDebugDraw=!1}}),cc._RF.pop()},{}],Utils:[function(t,e,o){"use strict";cc._RF.push(e,"2f7cclALwxFj4+EPuzNf8GQ","Utils"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,i=(n.property,function(){function t(){}return t._releaseResource=function(t,e){var o=cc.loader.getRes(t,e),n=cc.loader.getDependsRecursively(o);cc.loader.release(n)},t.loadSpriteFrame=function(t){this._releaseResource(t,cc.SpriteAtlas),cc.loader.loadRes(t,cc.SpriteAtlas,function(t,e){cc.loader.setAutoRelease(e,!0);var o=new cc.Node;o.position=cc.v2(0,0),o.addComponent(cc.Sprite).spriteFrame=e.getSpriteFrame("sheep_run_0")})},t.prototype.loadJson=function(t,e){cc.loader.loadRes(t,function(t,o){t?cc.log(t):e&&e(o)})},t.loadPrefab=function(t,e){this._releaseResource(t,cc.Prefab),cc.loader.loadRes(t,cc.Prefab,function(t,o){cc.loader.setAutoRelease(o,!0);var n=cc.instantiate(o);e&&e(n)})},t.prototype.loadInstruction=function(t){var e=t.split("/"),o=e[e.length-1].replace(".fire","");cc.loader.loadRes("readme/"+o,cc.TextAsset,function(t,e){})},t.prototype.sendXHR=function(t,e){var o=cc.loader.getXMLHttpRequest(),n=e||function(t){return" Response (30 chars): "+t.substring(0,30)+"..."};["loadstart","abort","error","load","loadend","timeout"].forEach(function(t){o["on"+t]=function(){}}),o.onreadystatechange=function(){4===o.readyState&&o.status>=200&&o.status<300&&n(o)},o.open("GET",t,!0),cc.sys.isNative&&o.setRequestHeader("Accept-Encoding","gzip,deflate"),o.timeout=5e3,o.send()},t=__decorate([a],t)}());o.default=i,cc._RF.pop()},{}]},{},["Constants","DataCenter","Game","House","Item","MainScene","Monster","MonsterManager","Player","NodeGenerator","PoolHandler","Bullet","Shooter","Utils"]);